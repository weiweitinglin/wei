<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>星際浮水印製造機</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../css/galaxy-theme.css" rel="stylesheet" />
    <link href="../css/fix-sizes.css" rel="stylesheet" />
    
    <!-- 確認對話框樣式 -->
    <style>
        /* 下載全部按鈕美化樣式 */
        .btn-download-all {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border: 2px solid transparent;
            border-radius: 30px;
            color: white;
            font-weight: 700;
            padding: 1.2rem 3rem;
            font-size: 1.1rem;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 8px 25px rgba(102, 126, 234, 0.4),
                0 4px 15px rgba(118, 75, 162, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            cursor: pointer;
            text-transform: uppercase;
            min-width: 200px;
            backdrop-filter: blur(10px);
        }

        .btn-download-all::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                transparent 50%, 
                rgba(255, 255, 255, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 28px;
        }

        .btn-download-all:hover {
            transform: translateY(-4px) scale(1.08);
            box-shadow: 
                0 15px 40px rgba(102, 126, 234, 0.6),
                0 8px 25px rgba(118, 75, 162, 0.4),
                0 4px 15px rgba(240, 147, 251, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #764ba2 0%, #f093fb 50%, #667eea 100%);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-download-all:hover::after {
            opacity: 1;
        }

        .btn-download-all:active {
            transform: translateY(-2px) scale(1.05);
            transition: all 0.1s ease;
        }

        .btn-download-all:disabled {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            cursor: not-allowed;
            transform: none;
            opacity: 0.5;
            border-color: transparent;
        }

        .btn-download-all:disabled:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-download-all:disabled::after {
            display: none;
        }

        /* 按鈕內的閃光效果 */
        .btn-shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                rgba(255, 255, 255, 0.6), 
                rgba(255, 255, 255, 0.4), 
                transparent);
            transition: left 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            z-index: 1;
        }

        .btn-download-all:hover .btn-shine {
            left: 100%;
        }

        .btn-download-all:disabled .btn-shine {
            display: none;
        }

        /* 按鈕文字效果 */
        .btn-download-all .btn-text {
            position: relative;
            z-index: 2;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .btn-download-all:hover .btn-text {
            text-shadow: 
                0 0 10px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(240, 147, 251, 0.5),
                0 0 30px rgba(102, 126, 234, 0.3);
        }

        /* 按鈕圖標效果 */
        .btn-download-all i {
            position: relative;
            z-index: 2;
            transition: all 0.4s ease;
            font-size: 1.3rem;
            margin-right: 12px;
        }

        .btn-download-all:hover i {
            animation: downloadFloat 2s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
        }

        @keyframes downloadFloat {
            0%, 100% { 
                transform: translateY(0) rotate(0deg); 
            }
            25% { 
                transform: translateY(-3px) rotate(-2deg); 
            }
            50% { 
                transform: translateY(-5px) rotate(0deg); 
            }
            75% { 
                transform: translateY(-3px) rotate(2deg); 
            }
        }

        /* 按鈕背景粒子效果 */
        .btn-download-all::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(255, 255, 255, 0.3) 0%, 
                rgba(240, 147, 251, 0.2) 50%, 
                transparent 100%);
            transform: translate(-50%, -50%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            z-index: 0;
        }

        .btn-download-all:active::before {
            width: 400px;
            height: 400px;
            opacity: 1;
            transition: all 0.2s ease;
        }

        /* 加載狀態效果 */
        .btn-download-all.loading {
            pointer-events: none;
        }

        .btn-download-all.loading i {
            animation: downloadSpin 1s linear infinite;
        }

        @keyframes downloadSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 成功狀態效果 */
        .btn-download-all.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            animation: successPulse 0.6s ease-out;
        }

        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .btn-download-all {
                padding: 1rem 2.5rem;
                font-size: 1rem;
                min-width: 180px;
            }
            
            .btn-download-all i {
                font-size: 1.2rem;
                margin-right: 10px;
            }
        }

        @media (max-width: 480px) {
            .btn-download-all {
                padding: 0.9rem 2rem;
                font-size: 0.95rem;
                min-width: 160px;
                letter-spacing: 0.5px;
            }
            
            .btn-download-all i {
                font-size: 1.1rem;
                margin-right: 8px;
            }
        }

        /* 預覽區域美化樣式 */
        .enhanced-preview-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .enhanced-preview-container:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(66, 245, 230, 0.3);
            box-shadow: 0 8px 25px rgba(66, 245, 230, 0.1);
        }

        /* 文件上傳區域樣式修復 - 徹底解決重疊問題 */
        .upload-zone {
            position: relative;
        }

        /* 移除 form-floating 對文件輸入框的影響 */
        .upload-zone .form-floating {
            margin-bottom: 20px;
            position: static;
        }

        /* 自定義標籤樣式，獨立於輸入框 */
        .upload-zone .custom-label {
            display: block;
            font-size: 1rem;
            font-weight: 500;
            color: #42f5e6;
            margin-bottom: 10px;
            padding: 0.5rem 1rem;
            background: rgba(26, 31, 58, 0.9);
            border: 1px solid rgba(66, 245, 230, 0.3);
            border-radius: 6px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .upload-zone .custom-label i {
            margin-right: 8px;
            color: #42f5e6;
        }

        .upload-zone .custom-label:hover {
            background: rgba(66, 245, 230, 0.1);
            border-color: #42f5e6;
        }

        /* 文件輸入框樣式 */
        .upload-zone .form-control {
            font-size: 1rem;
            padding: 1rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            transition: all 0.3s ease;
            min-height: 60px;
        }

        .upload-zone .form-control:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: #42f5e6;
            box-shadow: 0 0 0 0.2rem rgba(66, 245, 230, 0.25);
        }

        /* 隱藏原始的 floating label */
        .upload-zone .form-floating label {
            display: none;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .upload-zone .custom-label {
                font-size: 0.9rem;
                padding: 0.4rem 0.8rem;
                margin-bottom: 8px;
            }
            
            .upload-zone .form-control {
                font-size: 0.9rem;
                padding: 0.9rem 0.7rem;
                min-height: 55px;
            }
        }

        @media (max-width: 480px) {
            .upload-zone .custom-label {
                font-size: 0.85rem;
                padding: 0.3rem 0.7rem;
                margin-bottom: 6px;
            }

            .upload-zone .form-control {
                font-size: 0.85rem;
                padding: 0.8rem 0.6rem;
                min-height: 50px;
            }
        }

        /* 設定區域標籤樣式改善 */
        .settings-section .form-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: #42f5e6;
            margin-bottom: 20px;
            display: block;
            line-height: 1.8;
            padding: 8px 0;
        }

        .settings-section .form-label i {
            margin-right: 10px;
            font-size: 1.3rem;
            color: #42f5e6;
            vertical-align: middle;
        }

        .settings-section .form-label small {
            display: block;
            font-size: 0.9rem;
            color: #a3b2cc;
            font-weight: 400;
            margin-top: 8px;
            line-height: 1.5;
            padding-left: 0;
        }

        .settings-section .form-floating label {
            font-size: 1rem;
            color: #a3b2cc;
            font-weight: 500;
            padding: 1.2rem 1rem;
            line-height: 1.6;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .settings-section .form-floating label:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #42f5e6;
        }

        .settings-section .form-check-label {
            font-size: 1rem;
            color: #fff;
            font-weight: 500;
            margin-left: 10px;
            line-height: 1.7;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .settings-section .form-check-label:hover {
            color: #42f5e6;
        }

        .settings-section .form-check-label i {
            margin-right: 8px;
            color: #42f5e6;
            font-size: 1.1rem;
        }

        /* 透明度標籤特別處理 */
        .form-label .badge {
            font-size: 0.85rem;
            padding: 6px 12px;
            margin-left: 10px;
            background: linear-gradient(135deg, #42f5e6, #4285f4);
            color: #000;
            font-weight: 600;
            border-radius: 20px;
            letter-spacing: 0.5px;
        }

        /* 設定區域響應式設計 */
        @media (max-width: 768px) {
            .settings-section .form-label {
                font-size: 1rem;
                margin-bottom: 15px;
            }

            .settings-section .form-label i {
                margin-right: 8px;
                font-size: 1.2rem;
            }

            .settings-section .form-label small {
                font-size: 0.85rem;
                margin-top: 6px;
            }

            .settings-section .form-floating label {
                font-size: 0.9rem;
                padding: 1rem 0.8rem;
            }

            .settings-section .form-check-label {
                font-size: 0.9rem;
                margin-left: 8px;
            }
        }

        @media (max-width: 480px) {
            .settings-section .form-label {
                font-size: 0.95rem;
                line-height: 1.6;
            }

            .settings-section .form-label small {
                font-size: 0.8rem;
            }

            .settings-section .form-floating label {
                font-size: 0.85rem;
                padding: 0.9rem 0.7rem;
            }

            .form-label .badge {
                font-size: 0.75rem;
                padding: 4px 8px;
                margin-left: 6px;
            }
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .preview-header h5 {
            color: #42f5e6;
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .preview-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-text {
            font-size: 0.9rem;
            color: #a3b2cc;
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .count-badge {
            background: #42f5e6;
            color: #000;
            font-size: 0.8rem;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 50%;
            min-width: 20px;
            text-align: center;
        }

        .preview-area {
            min-height: 200px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .preview-area:hover {
            border-color: rgba(66, 245, 230, 0.5);
            background: rgba(66, 245, 230, 0.05);
        }

        .preview-placeholder,
        .gallery-placeholder {
            text-align: center;
            color: #a3b2cc;
        }

        .upload-icon {
            font-size: 3rem;
            color: #42f5e6;
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .upload-text {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #fff;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: #a3b2cc;
            margin: 0;
        }

        .preview-gallery {
            min-height: 200px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .preview-gallery:hover {
            border-color: rgba(66, 245, 230, 0.5);
            background: rgba(66, 245, 230, 0.05);
        }

        /* 增強預覽系統樣式 */
        .preview-workspace {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .preview-canvas-container {
            flex: 2;
            min-width: 400px;
            position: relative;
        }

        .preview-canvas {
            min-height: 400px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.05));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .preview-placeholder-main {
            text-align: center;
            color: #a3b2cc;
            padding: 40px;
        }

        .preview-icon {
            font-size: 4rem;
            color: #42f5e6;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .preview-placeholder-main h4 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .preview-steps {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #42f5e6, #4285f4);
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .step span {
            font-size: 0.8rem;
            color: #a3b2cc;
        }

        .preview-toolbar {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tool-btn {
            background: none;
            border: none;
            color: #fff;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            background: rgba(66, 245, 230, 0.2);
            color: #42f5e6;
        }

        .zoom-level {
            font-size: 0.9rem;
            color: #42f5e6;
            font-weight: 500;
            margin-left: 10px;
        }

        .preview-info-panel {
            flex: 1;
            min-width: 280px;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-section h6 {
            color: #42f5e6;
            margin-bottom: 15px;
            font-size: 1rem;
            font-weight: 600;
        }

        .info-grid {
            display: grid;
            gap: 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-item .label {
            color: #a3b2cc;
            font-size: 0.9rem;
        }

        .info-item .value {
            color: #fff;
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* 結果區域美化樣式 */
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .result-title h3 {
            color: #42f5e6;
            margin: 0;
            font-size: 1.5rem;
        }

        .result-stats {
            display: flex;
            gap: 20px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .stat-item {
            font-size: 0.9rem;
            color: #a3b2cc;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-item i {
            color: #42f5e6;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-result-action {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-result-action:hover {
            background: rgba(66, 245, 230, 0.2);
            border-color: #42f5e6;
            color: #42f5e6;
        }

        .result-grid-container {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .enhanced-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        /* 結果圖片容器樣式 - 防止圖片超出框架 */
        .result-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .result-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(66, 245, 230, 0.3);
            box-shadow: 0 8px 25px rgba(66, 245, 230, 0.1);
            transform: translateY(-2px);
        }

        .image-title {
            color: #42f5e6;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 12px;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        .image-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            transition: transform 0.3s ease;
        }

        .image-container:hover img {
            transform: scale(1.05);
        }

        .item-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .download-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 6px;
            color: white;
            padding: 8px 16px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .download-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .download-btn i {
            font-size: 0.9rem;
        }

        /* 結果項目選中狀態樣式 */
        .result-item.selected {
            border-color: #42f5e6;
            background: rgba(66, 245, 230, 0.15);
            box-shadow: 0 0 20px rgba(66, 245, 230, 0.3);
        }

        .result-item.selected::before {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 10px;
            right: 10px;
            background: #42f5e6;
            color: #000;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            z-index: 10;
        }

        .result-item {
            position: relative;
            cursor: pointer;
            user-select: none;
        }

        /* 空結果狀態樣式 */
        .empty-results {
            text-align: center;
            color: #a3b2cc;
            padding: 60px 20px;
        }

        .empty-results .empty-icon {
            font-size: 4rem;
            color: #42f5e6;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .empty-results h4 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .empty-results p {
            color: #a3b2cc;
            font-size: 1rem;
            margin: 0;
        }

        .processing-progress {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-text {
            color: #fff;
            font-weight: 500;
        }

        .progress-percentage {
            color: #42f5e6;
            font-weight: bold;
        }

        .progress-bar-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #42f5e6, #4285f4);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .progress-details {
            font-size: 0.9rem;
            color: #a3b2cc;
            text-align: center;
        }

        /* 按鈕美化 */
        .btn-cosmic-sm {
            background: linear-gradient(135deg, #42f5e6, #4285f4);
            border: none;
            color: #000;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-cosmic-sm:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(66, 245, 230, 0.3);
        }

        .btn-cosmic-outline-sm {
            background: transparent;
            border: 1px solid #42f5e6;
            color: #42f5e6;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-cosmic-outline-sm:hover {
            background: rgba(66, 245, 230, 0.1);
            transform: translateY(-2px);
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .preview-workspace {
                flex-direction: column;
            }

            .preview-canvas-container {
                min-width: auto;
            }

            .preview-info-panel {
                min-width: auto;
            }

            .result-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .enhanced-gallery {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }

            .result-item {
                padding: 12px;
            }

            .image-title {
                font-size: 0.85rem;
            }

            .preview-steps {
                flex-direction: column;
                gap: 15px;
            }

            .step {
                flex-direction: row;
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .enhanced-gallery {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .result-item {
                padding: 10px;
            }

            .image-title {
                font-size: 0.8rem;
                margin-bottom: 8px;
            }

            .download-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
        }

        .confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .confirm-dialog {
            background: linear-gradient(145deg, #1a1f3a, #2d3561);
            border: 2px solid #4a5568;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            text-align: center;
            color: white;
        }

        .confirm-icon {
            font-size: 3rem;
            color: #4fd1c7;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .confirm-dialog h3 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .confirm-dialog p {
            color: #a0aec0;
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .confirm-details {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }

        .confirm-details p {
            margin-bottom: 10px;
            font-weight: 500;
            color: #e2e8f0;
        }

        .confirm-details ul {
            margin: 0;
            padding-left: 20px;
        }

        .confirm-details li {
            color: #cbd5e0;
            margin-bottom: 5px;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .btn-confirm-cancel,
        .btn-confirm-ok {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .btn-confirm-cancel {
            background: linear-gradient(145deg, #4a5568, #2d3748);
            color: #e2e8f0;
        }

        .btn-confirm-cancel:hover {
            background: linear-gradient(145deg, #2d3748, #1a202c);
            transform: translateY(-2px);
        }

        .btn-confirm-ok {
            background: linear-gradient(145deg, #4fd1c7, #38b2ac);
            color: white;
        }

        .btn-confirm-ok:hover {
            background: linear-gradient(145deg, #38b2ac, #319795);
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>

<body id="page-top" class="watermark-generator">
    <!-- Particles.js 星座連線背景 -->
    <div id="particles-js"></div>
    
    <!-- Main Content -->
    <main class="calculator-container">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <!-- 標題區域 -->
                    <div class="text-center mb-5">
                        <h1 class="cosmic-title">
                            <i class="fas fa-magic me-2"></i>星際浮水印製造機
                        </h1>
                        <p class="cosmic-subtitle">銀河級圖像處理系統</p>
                        <p class="cosmic-description">運用星際科技為您的圖片添加專業浮水印</p>
                        
                        <!-- 快速導航按鈕 -->
                        <div class="quick-nav-buttons mt-4">
                            <button type="button" class="btn btn-galaxy-primary me-3" onclick="scrollToUpload()" id="startBtn">
                                <i class="fas fa-upload me-2"></i>開始製作
                            </button>
                            <button type="button" class="btn btn-galaxy-secondary" onclick="goToHomePage()" id="homeBtn">
                                <i class="fas fa-home me-2"></i>返回首頁
                            </button>
                        </div>
                    </div>

                    <div class="calculator-panel" id="uploadSection">
                        <!-- 上傳區域 -->
                        <div class="upload-section mb-4">
                            <div class="upload-card">
                                <div class="upload-header">
                                    <h2><i class="fas fa-cloud-upload-alt me-2"></i>圖像上傳台</h2>
                                </div>
                                <div class="upload-body">
                                    <div class="row">
                                        <div class="col-lg-6 mb-3">
                                            <div class="upload-zone">
                                                <label class="custom-label" for="watermarkInput">
                                                    <i class="fas fa-water me-2"></i>第一步：上傳浮水印圖片
                                                </label>
                                                <div class="form-floating">
                                                    <input type="file" class="form-control cosmic-input" id="watermarkInput" accept="image/*">
                                                </div>
                                                <!-- 美化的浮水印預覽區域 -->
                                                <div class="enhanced-preview-container mt-3">
                                                    <div class="preview-header">
                                                        <h5><i class="fas fa-image me-2"></i>浮水印預覽</h5>
                                                        <div class="preview-status" id="watermarkStatus">
                                                            <span class="status-text">尚未上傳</span>
                                                        </div>
                                                    </div>
                                                    <div class="preview-area" id="watermarkPreview">
                                                        <div class="preview-placeholder">
                                                            <div class="upload-icon">
                                                                <i class="fas fa-cloud-upload-alt"></i>
                                                            </div>
                                                            <p class="upload-text">點擊上方按鈕選擇浮水印圖片</p>
                                                            <p class="upload-hint">支援 JPG、PNG 格式</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 mb-3">
                                            <div class="upload-zone">
                                                <label class="custom-label" for="imagesInput">
                                                    <i class="fas fa-images me-2"></i>第二步：上傳要添加浮水印的圖片
                                                </label>
                                                <div class="form-floating">
                                                    <input type="file" class="form-control cosmic-input" id="imagesInput" accept="image/*" multiple>
                                                </div>
                                                <!-- 美化的圖片預覽區域 -->
                                                <div class="enhanced-preview-container mt-3">
                                                    <div class="preview-header">
                                                        <h5><i class="fas fa-images me-2"></i>圖片預覽</h5>
                                                        <div class="preview-status" id="imagesStatus">
                                                            <span class="status-text">尚未上傳</span>
                                                            <span class="count-badge" id="imageCount" style="display: none;">0</span>
                                                        </div>
                                                    </div>
                                                    <div class="preview-gallery" id="imagesPreview">
                                                        <div class="gallery-placeholder">
                                                            <div class="upload-icon">
                                                                <i class="fas fa-images"></i>
                                                            </div>
                                                            <p class="upload-text">點擊上方按鈕選擇圖片（可多選）</p>
                                                            <p class="upload-hint">支援 JPG、PNG 格式，最多 10 張</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 設定區域 -->
                        <div class="settings-section mb-4">
                            <div class="settings-card">
                                <div class="settings-header">
                                    <h2><i class="fas fa-cogs me-2"></i>浮水印參數控制台</h2>
                                </div>
                                <div class="settings-body">
                                    <div class="row g-4">
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-label">
                                                    <i class="fas fa-map-marker-alt me-2"></i>位置設定
                                                    <small class="text-muted d-block">選擇浮水印在圖片上的位置</small>
                                                </label>
                                                <div class="position-selector" data-tooltip="點擊選擇浮水印位置">
                                                    <button class="btn-cosmic position-btn" data-position="top-left" data-tooltip="左上角">左上</button>
                                                    <button class="btn-cosmic position-btn" data-position="top-right" data-tooltip="右上角">右上</button>
                                                    <button class="btn-cosmic position-btn active" data-position="center" id="defaultPosition" data-tooltip="居中位置">置中</button>
                                                    <button class="btn-cosmic position-btn" data-position="bottom-left" data-tooltip="左下角">左下</button>
                                                    <button class="btn-cosmic position-btn" data-position="bottom-right" data-tooltip="右下角">右下</button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-label">
                                                    <i class="fas fa-expand-arrows-alt me-2"></i>大小設定
                                                    <small class="text-muted d-block">調整浮水印的尺寸大小</small>
                                                </label>
                                                <div class="form-floating mb-2">
                                                    <input type="number" id="watermarkWidth" class="form-control cosmic-input" min="10" value="200" data-tooltip="浮水印寬度(像素)">
                                                    <label for="watermarkWidth">寬度 (像素)</label>
                                                </div>
                                                <div class="form-floating mb-2">
                                                    <input type="number" id="watermarkHeight" class="form-control cosmic-input" min="10" value="200" data-tooltip="浮水印高度(像素)">
                                                    <label for="watermarkHeight">高度 (像素)</label>
                                                </div>
                                                <div class="form-check">
                                                    <input type="checkbox" id="maintainAspect" class="form-check-input cosmic-checkbox" checked data-tooltip="保持原始長寬比例">
                                                    <label for="maintainAspect" class="form-check-label">
                                                        <i class="fas fa-lock me-2"></i>保持原始比例
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label for="opacityRange" class="form-label">
                                                    <i class="fas fa-layer-group me-2"></i>透明度: <span id="opacityValue" class="badge bg-gradient text-dark">50%</span>
                                                    <small class="text-muted d-block">調整浮水印的透明程度</small>
                                                </label>
                                                <input type="range" id="opacityRange" class="form-range cosmic-range" min="10" max="100" value="50" data-tooltip="拖動調整透明度">
                                                <div class="d-flex justify-content-between text-muted small mt-1">
                                                    <span>10%</span>
                                                    <span>50%</span>
                                                    <span>100%</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 預覽區域 -->
                        <div class="preview-section mb-4">
                            <div class="preview-card">
                                <div class="preview-header">
                                    <h2><i class="fas fa-eye me-2"></i>實時預覽系統</h2>
                                    <div class="preview-controls">
                                        <button id="previewBtn" class="btn-cosmic-sm" disabled>
                                            <i class="fas fa-eye me-2"></i>預覽效果
                                        </button>
                                        <button id="resetPreviewBtn" class="btn-cosmic-outline-sm" disabled>
                                            <i class="fas fa-redo me-2"></i>重置
                                        </button>
                                    </div>
                                </div>
                                <div class="preview-body">
                                    <!-- 預覽區域增強 -->
                                    <div class="preview-workspace">
                                        <div class="preview-canvas-container">
                                            <div id="previewImage" class="preview-canvas">
                                                <div class="preview-placeholder-main">
                                                    <div class="preview-icon">
                                                        <i class="fas fa-magic"></i>
                                                    </div>
                                                    <h4>預覽效果</h4>
                                                    <p class="text-muted">上傳圖片並調整設定後，點擊預覽按鈕查看效果</p>
                                                    <div class="preview-steps">
                                                        <div class="step">
                                                            <div class="step-number">1</div>
                                                            <span>上傳浮水印</span>
                                                        </div>
                                                        <div class="step">
                                                            <div class="step-number">2</div>
                                                            <span>上傳圖片</span>
                                                        </div>
                                                        <div class="step">
                                                            <div class="step-number">3</div>
                                                            <span>調整設定</span>
                                                        </div>
                                                        <div class="step">
                                                            <div class="step-number">4</div>
                                                            <span>預覽效果</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 預覽工具欄 -->
                                            <div class="preview-toolbar" id="previewToolbar" style="display: none;">
                                                <div class="toolbar-group">
                                                    <button class="tool-btn" id="zoomInBtn" title="放大">
                                                        <i class="fas fa-search-plus"></i>
                                                    </button>
                                                    <button class="tool-btn" id="zoomOutBtn" title="縮小">
                                                        <i class="fas fa-search-minus"></i>
                                                    </button>
                                                    <button class="tool-btn" id="fitToScreenBtn" title="適應螢幕">
                                                        <i class="fas fa-expand-arrows-alt"></i>
                                                    </button>
                                                </div>
                                                <div class="toolbar-group">
                                                    <span class="zoom-level" id="zoomLevel">100%</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 預覽信息面板 -->
                                        <div class="preview-info-panel" id="previewInfo" style="display: none;">
                                            <div class="info-section">
                                                <h6><i class="fas fa-info-circle me-2"></i>圖片資訊</h6>
                                                <div class="info-grid">
                                                    <div class="info-item">
                                                        <span class="label">尺寸:</span>
                                                        <span class="value" id="imageDimensions">-</span>
                                                    </div>
                                                    <div class="info-item">
                                                        <span class="label">格式:</span>
                                                        <span class="value" id="imageFormat">-</span>
                                                    </div>
                                                    <div class="info-item">
                                                        <span class="label">大小:</span>
                                                        <span class="value" id="imageSize">-</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="info-section">
                                                <h6><i class="fas fa-layer-group me-2"></i>浮水印設定</h6>
                                                <div class="info-grid">
                                                    <div class="info-item">
                                                        <span class="label">位置:</span>
                                                        <span class="value" id="watermarkPosition">居中</span>
                                                    </div>
                                                    <div class="info-item">
                                                        <span class="label">大小:</span>
                                                        <span class="value" id="watermarkSize">200x200</span>
                                                    </div>
                                                    <div class="info-item">
                                                        <span class="label">透明度:</span>
                                                        <span class="value" id="watermarkOpacity">50%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 生成和下載區域 -->
                        <div class="generate-section mb-4">
                            <div class="generate-card">
                                <div class="generate-header">
                                    <h2><i class="fas fa-magic me-2"></i>圖像處理與輸出</h2>
                                </div>
                                <div class="generate-body">
                                    <div class="row justify-content-center">
                                        <div class="col-lg-6">
                                            <div class="form-floating mb-3">
                                                <select id="outputFormat" class="form-select cosmic-select">
                                                    <option value="jpeg">JPEG</option>
                                                    <option value="png">PNG</option>
                                                </select>
                                                <label for="outputFormat">
                                                    <i class="fas fa-file-image me-2"></i>輸出格式
                                                </label>
                                            </div>
                                            
                                            <div class="form-group mb-4" id="jpegQualityContainer">
                                                <label for="jpegQuality" class="form-label">
                                                    <i class="fas fa-sliders-h me-2"></i>品質: <span id="qualityValue">90%</span>
                                                </label>
                                                <input type="range" id="jpegQuality" class="form-range cosmic-range" min="10" max="100" value="90">
                                            </div>
                                            
                                            <div class="text-center">
                                                <button id="processBtn" class="btn-cosmic me-3" disabled>
                                                    <i class="fas fa-magic me-2"></i>處理圖片
                                                </button>
                                                <button id="downloadBtn" class="btn-download-all" disabled>
                                                    <i class="fas fa-cloud-download-alt me-2"></i>
                                                    <span class="btn-text">下載全部</span>
                                                    <div class="btn-shine"></div>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 美化的結果顯示區域 -->
                                    <div class="result-display-area mt-4" id="resultSection" style="display: none;">
                                        <div class="result-header">
                                            <div class="result-title">
                                                <h3><i class="fas fa-check-circle me-2"></i>處理結果</h3>
                                                <div class="result-stats">
                                                    <span class="stat-item">
                                                        <i class="fas fa-images me-1"></i>
                                                        <span id="processedCount">0</span> 張已處理
                                                    </span>
                                                    <span class="stat-item">
                                                        <i class="fas fa-clock me-1"></i>
                                                        <span id="processingTime">0</span> 秒
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="result-actions">
                                                <button class="btn-result-action" id="selectAllBtn">
                                                    <i class="fas fa-check-square me-2"></i>全選
                                                </button>
                                                <button class="btn-result-action" id="downloadSelectedBtn">
                                                    <i class="fas fa-download me-2"></i>下載選中
                                                </button>
                                                <button class="btn-result-action" id="clearResultsBtn">
                                                    <i class="fas fa-trash me-2"></i>清空
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- 結果網格 -->
                                        <div class="result-grid-container">
                                            <div id="resultGallery" class="result-gallery enhanced-gallery">
                                                <!-- 結果將動態插入這裡 -->
                                            </div>
                                        </div>
                                        
                                        <!-- 處理進度條 -->
                                        <div class="processing-progress" id="processingProgress" style="display: none;">
                                            <div class="progress-header">
                                                <span class="progress-text">正在處理圖片...</span>
                                                <span class="progress-percentage">0%</span>
                                            </div>
                                            <div class="progress-bar-container">
                                                <div class="progress-bar" id="progressBar"></div>
                                            </div>
                                            <div class="progress-details">
                                                <span id="currentProcessing">準備開始...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="copyright">© 2025 TING造星球. All rights reserved.</p>
        </div>
    </footer>
    
    <!-- Processing Overlay -->
    <div id="processingOverlay" class="processing-overlay">
        <div class="processing-content">
            <div class="cosmic-spinner"></div>
            <div class="processing-text">正在處理圖片...</div>
            <div class="processing-details">請稍候，星際處理系統正在為您的圖片添加浮水印</div>
        </div>
    </div>

    <!-- Success Animation -->
    <div id="successAnimation" class="success-animation" style="display: none;">
        <div class="success-icon">
            <i class="fas fa-check"></i>
        </div>
        <div class="success-title">處理完成！</div>
        <div class="success-subtitle">您的圖片已成功添加浮水印</div>
    </div>

    <!-- Bootstrap 核心 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Particles JS -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    
    <!-- Particles JS 初始化和 Toast 系統 -->
    <script>
        // 多重 CDN 備援載入系統
        function loadParticlesJS() {
            return new Promise((resolve, reject) => {
                // 首先檢查是否已載入
                if (typeof particlesJS !== 'undefined') {
                    resolve();
                    return;
                }
                
                const cdnList = [
                    'https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js',
                    'https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js',
                    'https://unpkg.com/particles.js@2.0.0/particles.min.js'
                ];
                
                let currentCdn = 0;
                
                function tryLoadCdn() {
                    if (currentCdn >= cdnList.length) {
                        reject(new Error('All CDN sources failed'));
                        return;
                    }
                    
                    console.log(`嘗試載入 particles.js from: ${cdnList[currentCdn]}`);
                    const script = document.createElement('script');
                    script.src = cdnList[currentCdn];
                    
                    script.onload = function() {
                        console.log(`✅ particles.js 載入成功 from: ${cdnList[currentCdn]}`);
                        resolve();
                    };
                    
                    script.onerror = function() {
                        console.warn(`❌ particles.js 載入失敗 from: ${cdnList[currentCdn]}`);
                        currentCdn++;
                        tryLoadCdn();
                    };
                    
                    document.head.appendChild(script);
                }
                
                tryLoadCdn();
            });
        }

        // Particles.js 初始化函數（與銀河坪數計算器完全一致）
        window.initParticlesSystem = function() {
            if (typeof particlesJS !== 'undefined') {
                particlesJS("particles-js", {
                    particles: {
                        number: { 
                            value: window.innerWidth > 768 ? 80 : 40, 
                            density: { enable: true, value_area: 800 } 
                        },
                        color: { value: "#ffffff" },
                        shape: { 
                            type: "circle",
                            stroke: { width: 0, color: "#000000" }
                        },
                        opacity: { 
                            value: 0.5, 
                            random: true,
                            anim: { enable: true, speed: 1, opacity_min: 0.1, sync: false }
                        },
                        size: { 
                            value: 3, 
                            random: true,
                            anim: { enable: true, speed: 2, size_min: 0.1, sync: false }
                        },
                        line_linked: {
                            enable: true,
                            distance: 150,
                            color: "#ffffff",
                            opacity: 0.4,
                            width: 1
                        },
                        move: {
                            enable: true,
                            speed: 2,
                            direction: "none",
                            random: true,
                            straight: false,
                            out_mode: "out",
                            bounce: false,
                            attract: { enable: false, rotateX: 600, rotateY: 1200 }
                        }
                    },
                    interactivity: {
                        detect_on: "canvas",
                        events: {
                            onhover: { enable: true, mode: "repulse" },
                            onclick: { enable: true, mode: "push" },
                            resize: true
                        },
                        modes: {
                            grab: { distance: 400, line_linked: { opacity: 1 } },
                            bubble: { distance: 400, size: 40, duration: 2, opacity: 8, speed: 3 },
                            repulse: { distance: 200, duration: 0.4 },
                            push: { particles_nb: 4 },
                            remove: { particles_nb: 2 }
                        }
                    },
                    retina_detect: true
                });
                
                console.log('🎉 Particles.js 初始化成功！星座連線動畫已啟動');
                
                // 確保 particles 容器樣式正確
                const particlesContainer = document.getElementById('particles-js');
                if (particlesContainer) {
                    particlesContainer.style.cssText = `
                        position: fixed !important;
                        top: 0 !important;
                        left: 0 !important;
                        width: 100vw !important;
                        height: 100vh !important;
                        z-index: 1 !important;
                        pointer-events: none !important;
                        background: radial-gradient(ellipse at center, #1a1f3a 0%, #0f1527 50%, #000000 100%) !important;
                        overflow: hidden !important;
                    `;
                    console.log('✅ Particles 容器樣式已設定');
                    
                    // 強制觸發 Particles.js 重新渲染
                    setTimeout(() => {
                        const canvas = particlesContainer.querySelector('canvas');
                        if (canvas) {
                            console.log('✅ Particles canvas 已創建:', canvas);
                            canvas.style.visibility = 'visible';
                            canvas.style.opacity = '1';
                            canvas.style.display = 'block';
                            // 確保 canvas 有正確的尺寸
                            canvas.width = window.innerWidth;
                            canvas.height = window.innerHeight;
                        } else {
                            console.warn('❌ 找不到 particles canvas，重新初始化...');
                            // 重新初始化 Particles.js
                            setTimeout(() => {
                                if (typeof particlesJS !== 'undefined') {
                                    window.initParticlesSystem();
                                }
                            }, 500);
                        }
                    }, 500);
                }
            } else {
                console.warn('⚠️ Particles.js 載入失敗，使用備用星空效果');
                window.initFallbackAnimation();
            }
        };

        // 備用動畫系統（與銀河坪數計算器一致）
        window.initFallbackAnimation = function() {
            console.log('🎨 啟動備用 CSS 星空動畫...');
            const particlesContainer = document.getElementById('particles-js');
            if (particlesContainer) {
                particlesContainer.innerHTML = `
                    <div class="fallback-stars"></div>
                    <div class="fallback-stars-2"></div>
                    <div class="fallback-stars-3"></div>
                `;
                particlesContainer.classList.add('fallback-animation');
                particlesContainer.style.cssText = `
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100vw !important;
                    height: 100vh !important;
                    z-index: 1 !important;
                    pointer-events: none !important;
                    background: radial-gradient(ellipse at center, #1a1f3a 0%, #0f1527 50%, #000000 100%) !important;
                `;
                console.log('✅ 備用動畫已啟動');
            }
        };

        // Toast 提示訊息系統
        window.showToast = function(message, type = 'info') {
            // 檢查是否已存在 Toast，如果有則移除
            const existingToast = document.querySelector('.cosmic-toast');
            if (existingToast) {
                document.body.removeChild(existingToast);
            }
            
            // 建立新的 Toast 元素
            const toast = document.createElement('div');
            toast.className = `cosmic-toast cosmic-toast-${type}`;
            
            // 設置 Toast 內容
            const icon = type === 'success' ? 'check-circle' : 
                         type === 'error' ? 'exclamation-circle' : 
                         type === 'warning' ? 'exclamation-triangle' : 'info-circle';
                         
            toast.innerHTML = `
                <div class="cosmic-toast-content">
                    <i class="fas fa-${icon} me-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // 將 Toast 添加到頁面
            document.body.appendChild(toast);
            
            // 顯示 Toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // 自動隱藏 Toast
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        };

        // 滾動到上傳區域功能
        window.scrollToUpload = function() {
            const uploadSection = document.getElementById('uploadSection');
            if (uploadSection) {
                uploadSection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
                showToast('📤 準備開始上傳圖片！', 'info');
            }
        };

        // 返回首頁功能（自定義對話框版）
        window.goToHomePage = function() {
            console.log('🚀 返回首頁函數被調用');
            showHomeConfirmation();
        };

        // 顯示返回首頁確認對話框
        window.showHomeConfirmation = function() {
            const confirmDialog = document.createElement('div');
            confirmDialog.innerHTML = `
                <div id="homeConfirmDialog" class="confirm-overlay" style="display: flex;">
                    <div class="confirm-dialog">
                        <div class="confirm-icon">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <h3>星際傳送確認</h3>
                        <p>準備返回星球主控中心嗎？</p>
                        <div class="confirm-details">
                            <p>將會清除：</p>
                            <ul>
                                <li>目前的浮水印製作進度</li>
                                <li>所有上傳的圖片與設定</li>
                            </ul>
                        </div>
                        <div class="confirm-buttons">
                            <button class="btn-confirm-cancel" onclick="hideHomeConfirmation()">
                                取消
                            </button>
                            <button class="btn-confirm-ok" onclick="confirmGoHome()">
                                確定返回
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDialog);
        };

        // 隱藏返回首頁確認對話框
        window.hideHomeConfirmation = function() {
            const dialog = document.getElementById('homeConfirmDialog');
            if (dialog) {
                dialog.parentElement.remove();
            }
        };

        // 確認返回首頁
        window.confirmGoHome = function() {
            hideHomeConfirmation();
            showToast('🚀 正在傳送至星球主控中心...', 'info');
            setTimeout(() => {
                window.location.href = '../index.html';
            }, 800);
        };

        // 自定義星際主題確認對話框函數（簡化版）
        window.showCustomConfirm = function(options) {
            return new Promise((resolve) => {
                console.log('🎯 創建自定義確認對話框');
                
                try {
                    // 創建遮罩層
                    const overlay = document.createElement('div');
                    overlay.className = 'custom-confirm-overlay';
                    
                    // 創建對話框容器
                    const modal = document.createElement('div');
                    modal.className = 'custom-confirm-modal';
                    
                    // 創建對話框內容
                    const content = `
                        <div class="custom-confirm-header">
                            <div class="custom-confirm-icon">
                                <i class="${options.icon}"></i>
                            </div>
                            <h3 class="custom-confirm-title">${options.title}</h3>
                        </div>
                        <div class="custom-confirm-body">
                            <p class="custom-confirm-message">${options.message}</p>
                            ${options.details ? `
                                <div class="custom-confirm-details">
                                    <p>將會清除：</p>
                                    <ul>
                                        ${options.details.map(detail => `<li>${detail}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                        <div class="custom-confirm-actions">
                            <button class="custom-confirm-btn custom-confirm-btn-cancel" data-action="cancel">
                                ${options.cancelText}
                            </button>
                            <button class="custom-confirm-btn custom-confirm-btn-confirm" data-action="confirm">
                                ${options.confirmText}
                            </button>
                        </div>
                    `;
                    
                    modal.innerHTML = content;
                    overlay.appendChild(modal);
                    document.body.appendChild(overlay);
                    
                    // 添加點擊事件
                    const handleClick = (e) => {
                        const action = e.target.getAttribute('data-action');
                        if (action) {
                            console.log('🎯 用戶選擇:', action);
                            
                            // 移除對話框
                            overlay.classList.remove('show');
                            setTimeout(() => {
                                if (document.body.contains(overlay)) {
                                    document.body.removeChild(overlay);
                                }
                            }, 300);
                            
                            // 返回結果
                            resolve(action === 'confirm');
                        }
                    };
                    
                    // 點擊遮罩關閉
                    overlay.addEventListener('click', (e) => {
                        if (e.target === overlay) {
                            console.log('🎯 點擊遮罩關閉');
                            overlay.classList.remove('show');
                            setTimeout(() => {
                                if (document.body.contains(overlay)) {
                                    document.body.removeChild(overlay);
                                }
                            }, 300);
                            resolve(false);
                        }
                    });
                    
                    modal.addEventListener('click', handleClick);
                    
                    // 顯示動畫
                    setTimeout(() => {
                        overlay.classList.add('show');
                    }, 10);
                    
                } catch (error) {
                    console.error('❌ 自定義對話框創建失敗:', error);
                    // 降級到原生確認框
                    const confirmed = confirm(`${options.title}\n\n${options.message}\n\n將會清除：\n${options.details ? options.details.map(d => `• ${d}`).join('\n') : ''}`);
                    resolve(confirmed);
                }
            });
        };

        // 頁面載入完成後初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🌟 DOM載入完成，開始初始化...');
            
            // 強制初始化 Particles.js（多重保險）
            const initParticles = () => {
                console.log('🎯 強制初始化 Particles.js');
                
                if (typeof particlesJS !== 'undefined') {
                    window.initParticlesSystem();
                } else {
                    console.log('⚠️ Particles.js 尚未載入，使用備用動畫');
                    window.initFallbackAnimation();
                }
            };
            
            // 立即嘗試初始化
            initParticles();
            
            // 0.5秒後再次嘗試
            setTimeout(initParticles, 500);
            
            // 1秒後再次嘗試
            setTimeout(initParticles, 1000);
            
            // 強制載入 Particles.js
            loadParticlesJS().then(() => {
                console.log('✅ Particles.js 強制載入完成');
                setTimeout(() => {
                    window.initParticlesSystem();
                }, 100);
            }).catch(() => {
                console.log('🎨 強制載入失敗，使用備用動畫');
                window.initFallbackAnimation();
            });
            
            // 添加按鈕事件監聽器作為備用方案
            const homeBtn = document.getElementById('homeBtn');
            const startBtn = document.getElementById('startBtn');
            
            if (homeBtn) {
                homeBtn.addEventListener('click', function(e) {
                    console.log('🏠 備用返回首頁事件被觸發');
                    e.preventDefault();
                    e.stopPropagation();
                    goToHomePage();
                });
                console.log('✅ 返回首頁按鈕事件監聽器已添加');
                
                // 測試按鈕功能
                console.log('🧪 測試按鈕功能...');
                setTimeout(() => {
                    console.log('🔍 homeBtn元素:', homeBtn);
                    console.log('🔍 goToHomePage函數:', typeof goToHomePage);
                }, 1000);
            } else {
                console.error('❌ 無法找到返回首頁按鈕');
            }
            
            if (startBtn) {
                startBtn.addEventListener('click', function(e) {
                    console.log('🚀 備用開始製作事件被觸發');
                    e.preventDefault();
                    e.stopPropagation();
                    scrollToUpload();
                });
                console.log('✅ 開始製作按鈕事件監聽器已添加');
            } else {
                console.error('❌ 無法找到開始製作按鈕');
            }
            
            // 載入並初始化 Particles.js（移除重複載入）
            // 顯示歡迎 Toast
            setTimeout(() => {
                showToast('🌟 歡迎使用星際浮水印製造機！', 'success');
            }, 1000);
        });

        // 響應式調整
        window.addEventListener('resize', function() {
            if (typeof pJSDom !== 'undefined' && pJSDom[0] && pJSDom[0].pJS) {
                pJSDom[0].pJS.particles.number.value = window.innerWidth > 768 ? 80 : 40;
                pJSDom[0].pJS.fn.particlesRefresh();
            }
        });
    </script>
    
    <!-- 修復下拉選單 JS -->
    <script src="../js/dropdown-fix.js"></script>
    <!-- 自訂 JS -->
    <script src="../js/watermark.js"></script>
</body>
</html>