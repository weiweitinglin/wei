<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éŠ€æ²³åªæ•¸è¨ˆç®—å™¨ - å»·é€ æ˜Ÿçƒ</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../css/styles.css" rel="stylesheet">
    <link href="../css/enhanced-styles.css" rel="stylesheet">
    <link href="../css/galaxy-theme.css" rel="stylesheet">
    <link href="../css/fix-sizes.css" rel="stylesheet">
</head>

<body id="page-top" class="overtime-calculator">
    <!-- æ˜Ÿåº§é€£ç·šèƒŒæ™¯ -->
    <div id="particles-js"></div>
    
    <!-- å®‡å®™èƒŒæ™¯ -->
    <div class="cosmic-background">
        <div class="stars"></div>
        <div class="stars2"></div>
        <div class="stars3"></div>
    </div>

    <!-- å°èˆªæ¬„ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
        <div class="container px-4 px-lg-5">
            <!-- å°èˆªå“ç‰Œ -->
            <a class="navbar-brand" href="../index.html">
                <span class="brand-icon">
                    <div class="planet-ring"></div>
                    <div class="planet"></div>
                </span>
                TINGé€ æ˜Ÿçƒ
            </a>
            <!-- æ¼¢å ¡é¸å–®æŒ‰éˆ• -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>
            <!-- å°èˆªé¸é … -->
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="../index.html#about">æ˜Ÿçƒç°¡ä»‹</a></li>
                    <li class="nav-item"><a class="nav-link" href="../index.html#projects">åœ°è¡¨è³‡æº</a></li>
                    <li class="nav-item"><a class="nav-link" href="/wei/html/overtime_calculator.html">éŠ€æ²³å·¥æ™‚è¨ˆé‡å™¨</a></li>
                    <li class="nav-item"><a class="nav-link" href="/wei/html/QR code.html">æ˜Ÿç¢¼å·¥å» </a></li>
                    <!-- ä¸‹æ‹‰é¸å–® -->
                    <li class="nav-item dropdown mobile-dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="toolsDropdown" role="button" 
                           data-bs-toggle="dropdown" aria-expanded="false" 
                           aria-haspopup="true">
                            å°å·¥å…·è¡›æ˜Ÿ
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="toolsDropdown">
                            <li><a class="dropdown-item" href="/wei/html/flooring_calculator.html">åœ°æ¿æ‹¼æ¥è¨ˆç®—å™¨</a></li>
                            <li><a class="dropdown-item active" href="/wei/html/flooring_number of square meters.html">åªæ•¸è¨ˆç®—å™¨</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
    <div class="container calculator-container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- æ¨™é¡Œå€åŸŸ -->
                <div class="text-center mb-5">
                    <h1 class="cosmic-title">
                        <i class="fas fa-calculator me-2"></i>éŠ€æ²³åªæ•¸è¨ˆç®—å™¨
                    </h1>
                    <p class="cosmic-subtitle">è·¨éŠ€æ²³é€šè¨Šå”è­°</p>
                    <p class="cosmic-description">ç”¨æ˜Ÿéš›èªè¨€å‰µé€ è·¨éŠ€æ²³çš„è¯ç¹«æ–¹å¼</p>
                    
                    <!-- å¿«é€Ÿå°èˆªæŒ‰éˆ• -->
                    <div class="quick-nav-buttons mt-4">
                        <button type="button" class="btn btn-galaxy-primary me-3" onclick="scrollToCalculator()">
                            <i class="fas fa-rocket me-2"></i>é–‹å§‹è¨ˆç®—
                        </button>
                        <button type="button" class="btn btn-galaxy-secondary" onclick="goToHomePage()">
                            <i class="fas fa-home me-2"></i>è¿”å›é¦–é 
                        </button>
                    </div>
                </div>

                <!-- è¨ˆç®—å™¨ä¸»é«” -->
                <div class="calculator-panel" id="calculatorSection">
                    <div class="section-header mb-4">
                        <h2 class="section-title">
                            <i class="fas fa-atom me-2"></i>é‡å­åªæ•¸è½‰æ›å„€
                        </h2>
                        <p class="section-subtitle">ç²¾ç¢ºæ¸¬é‡æ‚¨çš„ç©ºé–“ç¶­åº¦</p>
                    </div>
                    <!-- è¼¸å…¥è¡¨å–® -->
                    <div class="row mb-4">
                        <div class="col-md-6 mb-3">
                            <label for="length_cm" class="form-label">
                                <i class="fas fa-arrows-alt-h me-2"></i>é•·åº¦ï¼ˆå…¬åˆ†ï¼‰
                            </label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="length_cm" placeholder="è«‹è¼¸å…¥é•·åº¦">
                                <span class="input-group-text">cm</span>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="width_cm" class="form-label">
                                <i class="fas fa-arrows-alt-v me-2"></i>å¯¬åº¦ï¼ˆå…¬åˆ†ï¼‰
                            </label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="width_cm" placeholder="è«‹è¼¸å…¥å¯¬åº¦">
                                <span class="input-group-text">cm</span>
                            </div>
                        </div>
                    </div>

    <!-- è¨ˆç®—æŒ‰éˆ• -->
                    <div class="text-center mb-4">
                        <button type="button" class="btn btn-cosmic calculate-btn" id="calculateBtn">
                            <i class="fas fa-rocket me-2"></i>å•Ÿå‹•è¨ˆç®—å¼•æ“
                        </button>
                    </div>

                    <!-- çµæœé¡¯ç¤º -->
                    <div class="row g-3 mb-4" id="resultsSection">
                        <div class="col-md-6">
                            <div class="info-box">
                                <h3><i class="fas fa-expand-arrows-alt me-2"></i>ç©ºé–“é¢ç©</h3>
                                <p id="areaResult">-- å¹³æ–¹å…¬å°º</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-box">
                                <h3><i class="fas fa-home me-2"></i>åªæ•¸æ›ç®—</h3>
                                <p id="pingResult">-- åª</p>
                            </div>
                        </div>
                    </div>

                    <!-- è¦–è¦ºåŒ–åœ–å½¢ -->
                    <div class="visual-box">
                        <h3 class="visual-title"><i class="fas fa-cube me-2"></i>3D ç©ºé–“è¦–è¦ºåŒ–</h3>
                        <div class="canvas-wrapper">
                            <canvas id="canvas" width="700" height="400"></canvas>
                        </div>
                        <div class="text-center mt-3">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                è¦–è¦ºåŒ–åœ–å½¢æœƒæ ¹æ“šæ‚¨è¼¸å…¥çš„å°ºå¯¸è‡ªå‹•èª¿æ•´æ¯”ä¾‹
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é å°¾ -->
    <footer class="footer bg-black small text-center text-white-50" style="padding: 2rem 0 3rem 0;">
        <div class="container px-4 px-lg-5">
            <div class="row justify-content-center">
                <div class="col-lg-6">
                    <p class="mb-2">
                        <span class="brand-icon-small me-2">
                            <div class="planet-ring-small"></div>
                            <div class="planet-small"></div>
                        </span>
                        TINGé€ æ˜Ÿçƒ
                    </p>
                    <p class="mb-0 opacity-75">Â© 2025 éŠ€æ²³è¨ˆç®—ç³»çµ± | æ¢ç´¢å®‡å®™é–“çš„ç²¾ç¢ºè¨ˆç®—</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Particles JS -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <!-- æ›´å¼·åŒ–çš„ Particles JS è¼‰å…¥ -->
    <script>
        // å¤šé‡ CDN å‚™æ´è¼‰å…¥ç³»çµ±
        function loadParticlesJS() {
            return new Promise((resolve, reject) => {
                // é¦–å…ˆæª¢æŸ¥æ˜¯å¦å·²è¼‰å…¥
                if (typeof particlesJS !== 'undefined') {
                    resolve();
                    return;
                }
                
                const cdnList = [
                    'https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js',
                    'https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js',
                    'https://unpkg.com/particles.js@2.0.0/particles.min.js'
                ];
                
                let currentCdn = 0;
                
                function tryLoadCdn() {
                    if (currentCdn >= cdnList.length) {
                        reject(new Error('All CDN sources failed'));
                        return;
                    }
                    
                    console.log(`å˜—è©¦è¼‰å…¥ particles.js from: ${cdnList[currentCdn]}`);
                    const script = document.createElement('script');
                    script.src = cdnList[currentCdn];
                    
                    script.onload = function() {
                        console.log(`âœ… particles.js è¼‰å…¥æˆåŠŸ from: ${cdnList[currentCdn]}`);
                        resolve();
                    };
                    
                    script.onerror = function() {
                        console.warn(`âŒ particles.js è¼‰å…¥å¤±æ•— from: ${cdnList[currentCdn]}`);
                        currentCdn++;
                        tryLoadCdn();
                    };
                    
                    document.head.appendChild(script);
                }
                
                tryLoadCdn();
            });
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œç«‹å³åŸ·è¡Œ
        window.addEventListener('load', function() {
            loadParticlesJS().then(() => {
                setTimeout(() => {
                    if (window.initParticlesSystem) {
                        window.initParticlesSystem();
                    }
                }, 100);
            }).catch((error) => {
                console.error('Failed to load particles.js:', error);
                // ä½¿ç”¨å‚™ç”¨å‹•ç•«
                if (window.initFallbackAnimation) {
                    window.initFallbackAnimation();
                }
            });
        });
    </script>
    <!-- è‡ªå®šç¾© JS -->
    <script>
        // èˆ‡é¦–é å®Œå…¨ä¸€è‡´çš„ particles.js åˆå§‹åŒ–
        window.initParticlesSystem = function() {
            if (typeof particlesJS !== 'undefined') {                    particlesJS("particles-js", {
                        particles: {
                            number: { 
                                value: window.innerWidth > 768 ? 80 : 40, 
                                density: { enable: true, value_area: 800 } 
                            },
                            color: { value: "#ffffff" },
                            shape: { 
                                type: "circle",
                                stroke: { width: 0, color: "#000000" }
                            },
                            opacity: { 
                                value: 0.5, 
                                random: true,
                                anim: { enable: true, speed: 1, opacity_min: 0.1, sync: false }
                            },
                            size: { 
                                value: 3, 
                                random: true,
                                anim: { enable: true, speed: 2, size_min: 0.1, sync: false }
                            },
                            line_linked: {
                                enable: true,
                                distance: 150,
                                color: "#ffffff",
                                opacity: 0.4,
                                width: 1
                            },
                            move: {
                                enable: true,
                                speed: 2,
                                direction: "none",
                                random: true,
                                straight: false,
                                out_mode: "out",
                                bounce: false,
                                attract: { enable: false, rotateX: 600, rotateY: 1200 }
                            }
                        },
                        interactivity: {
                            detect_on: "canvas",
                            events: {
                                onhover: { enable: true, mode: "repulse" },
                                onclick: { enable: true, mode: "push" },
                                resize: true
                            },
                            modes: {
                                grab: { distance: 400, line_linked: { opacity: 1 } },
                                bubble: { distance: 400, size: 40, duration: 2, opacity: 8, speed: 3 },
                                repulse: { distance: 200, duration: 0.4 },
                                push: { particles_nb: 4 },
                                remove: { particles_nb: 2 }
                            }
                        },
                        retina_detect: true
                    });
                    
                    console.log('ğŸ‰ Particles.js åˆå§‹åŒ–æˆåŠŸï¼æ˜Ÿåº§é€£ç·šå‹•ç•«å·²å•Ÿå‹•');
                    
                    // ç¢ºä¿ particles å®¹å™¨æ¨£å¼æ­£ç¢º
                    const particlesContainer = document.getElementById('particles-js');
                    if (particlesContainer) {
                        particlesContainer.style.cssText = `
                            position: fixed !important;
                            top: 0 !important;
                            left: 0 !important;
                            width: 100% !important;
                            height: 100% !important;
                            z-index: 1 !important;
                            pointer-events: none !important;
                            background: transparent !important;
                        `;
                        console.log('âœ… Particles å®¹å™¨æ¨£å¼å·²è¨­å®š');
                        
                        // æª¢æŸ¥ particles.js æ˜¯å¦å‰µå»ºäº† canvas
                        setTimeout(() => {
                            const canvas = particlesContainer.querySelector('canvas');
                            if (canvas) {
                                console.log('âœ… Particles canvas å·²å‰µå»º:', canvas);
                                canvas.style.visibility = 'visible';
                                canvas.style.opacity = '1';
                            } else {
                                console.warn('âŒ æ‰¾ä¸åˆ° particles canvas');
                            }
                        }, 500);
                    }
            } else {
                console.log('Particles.js æœªè¼‰å…¥ï¼Œä½¿ç”¨å‚™ç”¨å‹•ç•«');
                window.initFallbackAnimation();
            }
        }
        
        // å‚™ç”¨å‹•ç•«ç³»çµ±
        window.initFallbackAnimation = function() {
            console.log('ğŸ¨ å•Ÿå‹•å‚™ç”¨ CSS æ˜Ÿç©ºå‹•ç•«...');
            const particlesContainer = document.getElementById('particles-js');
            if (particlesContainer) {
                particlesContainer.innerHTML = `
                    <div class="fallback-stars"></div>
                    <div class="fallback-stars-2"></div>
                    <div class="fallback-stars-3"></div>
                `;
                particlesContainer.classList.add('fallback-animation');
                particlesContainer.style.cssText = `
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100% !important;
                    height: 100% !important;
                    z-index: 1 !important;
                    pointer-events: none !important;
                `;
                console.log('âœ… å‚™ç”¨å‹•ç•«å·²å•Ÿå‹•');
            }
        }
        
        // ç«‹å³æª¢æŸ¥ä¸¦åˆå§‹åŒ–ï¼ˆæœ€å„ªå…ˆï¼‰
        if (typeof particlesJS !== 'undefined') {
            setTimeout(window.initParticlesSystem, 50);
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œç«‹å³åˆå§‹åŒ–
        window.addEventListener('load', function() {
            setTimeout(window.initParticlesSystem, 100);
        });
        
        // DOM è¼‰å…¥å®Œæˆå¾Œä¹Ÿå˜—è©¦åˆå§‹åŒ–ï¼ˆé›™é‡ä¿éšªï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (typeof particlesJS !== 'undefined') {
                    window.initParticlesSystem();
                } else {
                    // å¦‚æœé‚„æ˜¯æ²’è¼‰å…¥ï¼Œå¼·åˆ¶é‡æ–°è¼‰å…¥
                    console.log('å¼·åˆ¶é‡æ–°è¼‰å…¥ particles.js...');
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js';
                    script.onload = function() {
                        setTimeout(window.initParticlesSystem, 100);
                    };
                    document.head.appendChild(script);
                }
            }, 500);
        });
        
        // ç•¶é é¢è¼‰å…¥å®Œæˆæ™‚åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // ç²å–DOMå…ƒç´ 
            const lengthInput = document.getElementById('length_cm');
            const widthInput = document.getElementById('width_cm');
            const calculateBtn = document.getElementById('calculateBtn');
            const areaResultElement = document.getElementById('areaResult');
            const pingResultElement = document.getElementById('pingResult');
            const canvas = document.getElementById('canvas');
            
            // åˆå§‹åŒ–ç•«å¸ƒ
            initCanvas();
            
            // ç¶å®šæŒ‰éˆ•é»æ“Šäº‹ä»¶
            calculateBtn.addEventListener('click', calculateArea);
            
            // è¨ˆç®—é¢ç©å‡½æ•¸
            function calculateArea() {
                try {
                    // ç²å–è¼¸å…¥å€¼
                    const length = parseFloat(lengthInput.value);
                    const width = parseFloat(widthInput.value);
                    
                    // é©—è­‰è¼¸å…¥
                    if (isNaN(length) || isNaN(width)) {
                        showToast('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—ï¼', 'error');
                        return;
                    }
                    
                    if (length <= 0 || width <= 0) {
                        showToast('é•·åº¦å’Œå¯¬åº¦å¿…é ˆæ˜¯æ­£æ•¸ï¼', 'error');
                        return;
                    }
                    
                    // è¨ˆç®—åªæ•¸
                    const areaSquareMeters = (length / 100) * (width / 100);
                    const areaPing = areaSquareMeters / 3.305785;
                    
                    // é¡¯ç¤ºçµæœ
                    areaResultElement.textContent = `${areaSquareMeters.toFixed(2)} å¹³æ–¹å…¬å°º`;
                    pingResultElement.textContent = `${areaPing.toFixed(2)} åª`;
                    
                    // çµæœå€åŸŸæ·¡å…¥æ•ˆæœ
                    const resultsSection = document.getElementById('resultsSection');
                    resultsSection.style.opacity = '0';
                    resultsSection.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        resultsSection.style.transition = 'all 0.5s ease';
                        resultsSection.style.opacity = '1';
                        resultsSection.style.transform = 'translateY(0)';
                    }, 100);
                    
                    // çµæœå‹•ç•«æ•ˆæœ
                    animateResults();
                    
                    // ç¹ªè£½çŸ©å½¢
                    drawRectangle(length, width);
                    
                    // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                    showToast('è¨ˆç®—å®Œæˆï¼', 'success');
                    
                } catch (error) {
                    console.error("è¨ˆç®—éŒ¯èª¤:", error);
                    showToast('è¨ˆç®—éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼', 'error');
                }
            }
            
            // åˆå§‹åŒ–ç•«å¸ƒ
            function initCanvas() {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // è¨­ç½®æ·±ç©ºèƒŒæ™¯æ¼¸è®Š
                const bgGradient = ctx.createRadialGradient(
                    canvas.width / 2, canvas.height / 2, 0,
                    canvas.width / 2, canvas.height / 2, Math.max(canvas.width, canvas.height) / 2
                );
                bgGradient.addColorStop(0, '#1a1f3a');
                bgGradient.addColorStop(0.7, '#0f1527');
                bgGradient.addColorStop(1, '#000000');
                
                ctx.fillStyle = bgGradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // ç¹ªè£½å‹•æ…‹æ˜Ÿæ˜ŸèƒŒæ™¯
                drawAdvancedStars(ctx, 150);
                
                // é¡¯ç¤ºç­‰å¾…æç¤º
                ctx.font = '18px "Space Grotesk", sans-serif';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸš€ æº–å‚™å•Ÿå‹•è¨ˆç®—å¼•æ“', canvas.width / 2, canvas.height / 2 - 10);
                ctx.font = '14px "Space Grotesk", sans-serif';
                ctx.fillStyle = 'rgba(66, 245, 230, 0.8)';
                ctx.fillText('è¼¸å…¥å°ºå¯¸ä»¥æŸ¥çœ‹ 3D è¦–è¦ºåŒ–æ•ˆæœ', canvas.width / 2, canvas.height / 2 + 15);
            }
            
            // ç¹ªè£½é€²éšæ˜Ÿæ˜ŸèƒŒæ™¯
            function drawAdvancedStars(ctx, count) {
                for (let i = 0; i < count; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const radius = Math.random() * 2 + 0.5;
                    const opacity = Math.random() * 0.8 + 0.2;
                    
                    // ä¸»æ˜Ÿæ˜Ÿ
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
                    ctx.fill();
                    
                    // å½©è‰²å…‰æšˆæ•ˆæœ
                    if (Math.random() > 0.7) {
                        const colors = ['66, 245, 230', '66, 133, 244', '139, 92, 246'];
                        const color = colors[Math.floor(Math.random() * colors.length)];
                        
                        ctx.beginPath();
                        ctx.arc(x, y, radius * 4, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(${color}, ${opacity * 0.2})`;
                        ctx.fill();
                        
                        // åå­—æ˜ŸèŠ’æ•ˆæœ
                        if (Math.random() > 0.8) {
                            ctx.strokeStyle = `rgba(${color}, ${opacity * 0.6})`;
                            ctx.lineWidth = 0.5;
                            ctx.beginPath();
                            ctx.moveTo(x - radius * 6, y);
                            ctx.lineTo(x + radius * 6, y);
                            ctx.moveTo(x, y - radius * 6);
                            ctx.lineTo(x, y + radius * 6);
                            ctx.stroke();
                        }
                    }
                }
            }
            
            // ç¹ªè£½çŸ©å½¢
            function drawRectangle(length, width) {
                const ctx = canvas.getContext('2d');
                
                // é‡æ–°åˆå§‹åŒ–èƒŒæ™¯
                initCanvas();
                
                // è¨ˆç®—é©ç•¶çš„ç¸®æ”¾æ¯”ä¾‹
                const maxDimension = Math.max(length, width);
                const scaleFactor = Math.min(canvas.width * 0.6 / width, canvas.height * 0.6 / length);
                
                // ç¸®æ”¾å¾Œçš„å°ºå¯¸
                const lengthScaled = length * scaleFactor;
                const widthScaled = width * scaleFactor;
                
                // è¨ˆç®—å±…ä¸­ä½ç½®
                const startX = (canvas.width - widthScaled) / 2;
                const startY = (canvas.height - lengthScaled) / 2;
                
                // å»ºç«‹å¤šå±¤æ¼¸è®Šæ•ˆæœ
                const mainGradient = ctx.createLinearGradient(startX, startY, startX + widthScaled, startY + lengthScaled);
                mainGradient.addColorStop(0, 'rgba(66, 245, 230, 0.3)');
                mainGradient.addColorStop(0.5, 'rgba(66, 133, 244, 0.4)');
                mainGradient.addColorStop(1, 'rgba(139, 92, 246, 0.3)');
                
                // ç¹ªè£½é™°å½±
                ctx.shadowBlur = 20;
                ctx.shadowColor = 'rgba(66, 245, 230, 0.5)';
                
                // ç¹ªè£½ä¸»çŸ©å½¢
                ctx.fillStyle = mainGradient;
                ctx.strokeStyle = '#42f5e6';
                ctx.lineWidth = 2;
                
                ctx.beginPath();
                ctx.rect(startX, startY, widthScaled, lengthScaled);
                ctx.fill();
                ctx.stroke();
                
                // ç§»é™¤é™°å½±
                ctx.shadowBlur = 0;
                
                // ç¹ªè£½é‚Šæ¡†è£é£¾
                ctx.strokeStyle = 'rgba(66, 245, 230, 0.8)';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.rect(startX - 5, startY - 5, widthScaled + 10, lengthScaled + 10);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // ç¹ªè£½å°ºå¯¸æ¨™ç±¤ï¼ˆå„ªåŒ–æ¨£å¼ï¼‰
                ctx.font = 'bold 14px "Space Grotesk", sans-serif';
                ctx.fillStyle = '#ffffff';
                ctx.textAlign = 'center';
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.lineWidth = 3;
                
                // å¯¬åº¦æ¨™ç±¤
                const widthText = `å¯¬åº¦: ${width} cm`;
                ctx.strokeText(widthText, startX + widthScaled / 2, startY + lengthScaled + 30);
                ctx.fillText(widthText, startX + widthScaled / 2, startY + lengthScaled + 30);
                
                // é•·åº¦æ¨™ç±¤
                ctx.save();
                ctx.translate(startX - 30, startY + lengthScaled / 2);
                ctx.rotate(-Math.PI / 2);
                const lengthText = `é•·åº¦: ${length} cm`;
                ctx.strokeText(lengthText, 0, 0);
                ctx.fillText(lengthText, 0, 0);
                ctx.restore();
                
                // ç¹ªè£½è£é£¾æ€§è§’è½
                drawEnhancedCorners(ctx, startX, startY, widthScaled, lengthScaled);
                
                // æ·»åŠ ç¶²æ ¼æ•ˆæœ
                drawGrid(ctx, startX, startY, widthScaled, lengthScaled);
            }
            
            // ç¹ªè£½å¢å¼·å‹è§’è½è£é£¾
            function drawEnhancedCorners(ctx, x, y, width, height) {
                const corners = [
                    {x: x, y: y},
                    {x: x + width, y: y},
                    {x: x, y: y + height},
                    {x: x + width, y: y + height}
                ];
                
                corners.forEach(corner => {
                    // ä¸»è¦å…‰é»
                    ctx.beginPath();
                    ctx.arc(corner.x, corner.y, 4, 0, Math.PI * 2);
                    ctx.fillStyle = '#42f5e6';
                    ctx.fill();
                    
                    // å…‰æšˆæ•ˆæœ
                    ctx.beginPath();
                    ctx.arc(corner.x, corner.y, 12, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(66, 245, 230, 0.4)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    // åå­—ç·šè£é£¾
                    ctx.strokeStyle = 'rgba(66, 245, 230, 0.6)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(corner.x - 8, corner.y);
                    ctx.lineTo(corner.x + 8, corner.y);
                    ctx.moveTo(corner.x, corner.y - 8);
                    ctx.lineTo(corner.x, corner.y + 8);
                    ctx.stroke();
                });
            }
            
            // ç¹ªè£½ç¶²æ ¼æ•ˆæœ
            function drawGrid(ctx, x, y, width, height) {
                ctx.strokeStyle = 'rgba(66, 245, 230, 0.1)';
                ctx.lineWidth = 0.5;
                
                const gridSize = 20;
                
                // å‚ç›´ç·š
                for (let i = gridSize; i < width; i += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(x + i, y);
                    ctx.lineTo(x + i, y + height);
                    ctx.stroke();
                }
                
                // æ°´å¹³ç·š
                for (let i = gridSize; i < height; i += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(x, y + i);
                    ctx.lineTo(x + width, y + i);
                    ctx.stroke();
                }
            }
            
            // çµæœæ•¸å­—å‹•ç•«æ•ˆæœ
            function animateResults() {
                const infoBoxes = document.querySelectorAll('.info-box');
                infoBoxes.forEach((box, index) => {
                    // éŒ¯é–‹å‹•ç•«æ™‚é–“
                    setTimeout(() => {
                        box.classList.add('pulse-animation');
                        
                        // æ•¸å­—å‹•ç•«æ•ˆæœ
                        const resultText = box.querySelector('p');
                        const originalText = resultText.textContent;
                        resultText.style.transform = 'scale(1.1)';
                        resultText.style.color = '#42f5e6';
                        
                        setTimeout(() => {
                            resultText.style.transform = 'scale(1)';
                            resultText.style.color = '';
                        }, 300);
                        
                        setTimeout(() => {
                            box.classList.remove('pulse-animation');
                        }, 600);
                    }, index * 200);
                });
            }
            
            // Toast æç¤ºè¨Šæ¯
            function showToast(message, type = 'info') {
                // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ Toastï¼Œå¦‚æœæœ‰å‰‡ç§»é™¤
                const existingToast = document.querySelector('.cosmic-toast');
                if (existingToast) {
                    document.body.removeChild(existingToast);
                }
                
                // å»ºç«‹æ–°çš„ Toast å…ƒç´ 
                const toast = document.createElement('div');
                toast.className = `cosmic-toast cosmic-toast-${type}`;
                
                // è¨­ç½® Toast å…§å®¹
                const icon = type === 'success' ? 'check-circle' : 
                             type === 'error' ? 'exclamation-circle' : 
                             type === 'warning' ? 'exclamation-triangle' : 'info-circle';
                             
                toast.innerHTML = `
                    <div class="cosmic-toast-content">
                        <i class="fas fa-${icon} me-2"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                // å°‡ Toast æ·»åŠ åˆ°é é¢
                document.body.appendChild(toast);
                
                // é¡¯ç¤º Toast
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                // è‡ªå‹•éš±è— Toast
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 3000);
            }
            
            // å¿«é€Ÿå°èˆªåŠŸèƒ½
            window.scrollToCalculator = function() {
                const calculatorSection = document.getElementById('calculatorSection');
                calculatorSection.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // èšç„¦åˆ°ç¬¬ä¸€å€‹è¼¸å…¥æ¡†
                setTimeout(() => {
                    lengthInput.focus();
                    // æ·»åŠ è¼•å¾®çš„ç™¼å…‰æ•ˆæœæç¤º
                    lengthInput.style.boxShadow = '0 0 20px rgba(66, 245, 230, 0.6)';
                    setTimeout(() => {
                        lengthInput.style.boxShadow = '';
                    }, 2000);
                }, 500);
            };
            
            // è‡ªå®šç¾©ç¢ºèªå°è©±æ¡†
            function showCustomConfirm(options) {
                return new Promise((resolve) => {
                    // å‰µå»ºå°è©±æ¡†å…ƒç´ 
                    const overlay = document.createElement('div');
                    overlay.className = 'custom-confirm-overlay';
                    
                    overlay.innerHTML = `
                        <div class="custom-confirm-modal">
                            <div class="custom-confirm-header">
                                <div class="custom-confirm-icon">
                                    <i class="${options.icon || 'fas fa-rocket'}"></i>
                                </div>
                                <h5 class="custom-confirm-title">${options.title || 'ç¢ºèªæ“ä½œ'}</h5>
                            </div>
                            <div class="custom-confirm-message">
                                ${options.message || 'ç¢ºå®šè¦åŸ·è¡Œæ­¤æ“ä½œå—ï¼Ÿ'}
                            </div>
                            ${options.details ? `
                                <div class="custom-confirm-details">
                                    <h6>é€™å°‡æ¸…é™¤ï¼š</h6>
                                    <ul>
                                        ${options.details.map(item => `<li>${item}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            <div class="custom-confirm-actions">
                                <button class="custom-confirm-btn custom-confirm-btn-cancel">
                                    ${options.cancelText || 'å–æ¶ˆ'}
                                </button>
                                <button class="custom-confirm-btn custom-confirm-btn-confirm">
                                    ${options.confirmText || 'ç¢ºå®š'}
                                </button>
                            </div>
                        </div>
                    `;
                    
                    // æ·»åŠ åˆ°é é¢
                    document.body.appendChild(overlay);
                    
                    // é¡¯ç¤ºå°è©±æ¡†
                    setTimeout(() => {
                        overlay.classList.add('show');
                    }, 10);
                    
                    // ç¶å®šäº‹ä»¶
                    const cancelBtn = overlay.querySelector('.custom-confirm-btn-cancel');
                    const confirmBtn = overlay.querySelector('.custom-confirm-btn-confirm');
                    
                    function cleanup() {
                        overlay.classList.remove('show');
                        setTimeout(() => {
                            if (document.body.contains(overlay)) {
                                document.body.removeChild(overlay);
                            }
                        }, 300);
                    }
                    
                    cancelBtn.onclick = () => {
                        cleanup();
                        resolve(false);
                    };
                    
                    confirmBtn.onclick = () => {
                        cleanup();
                        resolve(true);
                    };
                    
                    // é»æ“ŠèƒŒæ™¯é—œé–‰
                    overlay.onclick = (e) => {
                        if (e.target === overlay) {
                            cleanup();
                            resolve(false);
                        }
                    };
                    
                    // ESC éµé—œé–‰
                    const handleKeydown = (e) => {
                        if (e.key === 'Escape') {
                            cleanup();
                            resolve(false);
                            document.removeEventListener('keydown', handleKeydown);
                        }
                    };
                    document.addEventListener('keydown', handleKeydown);
                });
            }
            
            window.goToHomePage = async function() {
                // ä½¿ç”¨è‡ªå®šç¾©ç¢ºèªå°è©±æ¡†
                const confirmed = await showCustomConfirm({
                    title: 'æ˜Ÿéš›å‚³é€ç¢ºèª',
                    message: 'æº–å‚™è¿”å›åˆ°æ˜Ÿçƒä¸»æ§ä¸­å¿ƒå—ï¼Ÿ',
                    icon: 'fas fa-rocket',
                    details: [
                        'ç›®å‰çš„åªæ•¸è¨ˆç®—è³‡æ–™',
                        'æ‰€æœ‰è¼¸å…¥æ•¸å€¼èˆ‡çµæœ'
                    ],
                    confirmText: 'ç¢ºå®š',
                    cancelText: 'å–æ¶ˆ'
                });
                
                if (confirmed) {
                    // æ·»åŠ å‚³é€æ•ˆæœ
                    showToast('ğŸš€ æ­£åœ¨å‚³é€è‡³æ˜Ÿçƒä¸»æ§ä¸­å¿ƒ...', 'info');
                    setTimeout(() => {
                        window.location.href = '../index.html';
                    }, 800);
                }
            };
            
            // ç‚ºè¼¸å…¥æ¡†æ·»åŠ éµç›¤äº‹ä»¶ç›£è½
            lengthInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    widthInput.focus();
                }
            });
            
            widthInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    calculateArea();
                }
            });
            
            // å‚™ç”¨å‹•ç•«ï¼ˆå¦‚æœ particles.js å¤±æ•—ï¼‰
            function initFallbackAnimation() {
                console.log('ä½¿ç”¨å‚™ç”¨ CSS å‹•ç•«...');
                const particlesContainer = document.getElementById('particles-js');
                if (particlesContainer) {
                    particlesContainer.innerHTML = `
                        <div class="fallback-stars"></div>
                        <div class="fallback-stars-2"></div>
                        <div class="fallback-stars-3"></div>
                    `;
                    particlesContainer.classList.add('fallback-animation');
                }
            }
        });
    </script>
</body>
</html>
